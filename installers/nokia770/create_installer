#!/bin/sh
#
# generate an installer tree for the Nokia770

# 1. Define locations for various necessary files
#
# APPLICATION to be defined in lowercase letters only
APPLICATION=ambulantplayer
VERSION=2.0
INSTALL_DIR=`pwd`
AMBULANT_TOPDIR="$INSTALL_DIR/../.."
SRC_DIR=$AMBULANT_TOPDIR/src/player_gtk
DST_DIR="`pwd`/debian/$APPLICATION-app"
DEBIAN="$DST_DIR/DEBIAN"
HICOLOR="$DST_DIR/usr/share/icons/hicolor"
TARGET=`sb-conf current`

# locale dependant messages
# English
EN_LC_MESSAGES="$DST_DIR/usr/share/locale/en/LC_MESSAGES"
# Dutch
NL_LC_MESSAGES="$DST_DIR/usr/share/locale/nl/LC_MESSAGES"

# hildon desktop file
DESKTOP="$DST_DIR/usr/share/applications/hildon"

# dbus service file
SERVICE="$DST_DIR/usr/share/dbus-1/services"

# binaries
BIN="$DST_DIR/usr/bin"
LIB="$DST_DIR/usr/lib"

# Ambulant related configuration

# 2. Create directories needed
#
mkdir -p $DEBIAN
mkdir -p $HICOLOR/scalable/hildon
mkdir -p $HICOLOR/40x40/hildon
mkdir -p $HICOLOR/26x26/hildon
mkdir -p $EN_LC_MESSAGES
mkdir -p $NL_LC_MESSAGES
mkdir -p $DESKTOP
mkdir -p $SERVICE
mkdir -p $BIN
mkdir -p $LIB

# 3. Copy stuff needed but not generated by the package builder
#
#  Nokia770/800 subsystems specific
if [ $TARGET = "CHINOOK_ARMEL" ] ; then
  cp $INSTALL_DIR/AmbulantPlayer-scalable.png  $HICOLOR/scalable/hildon/AmbulantPlayer.png
  cp $INSTALL_DIR/AmbulantPlayer-40x40.png  $HICOLOR/40x40/hildon/AmbulantPlayer.png
  cp $INSTALL_DIR/AmbulantPlayer-26x26.png  $HICOLOR/26x26/hildon/AmbulantPlayer.png
  cp $INSTALL_DIR/AmbulantPlayerCHINOOK.desktop $DESKTOP/AmbulantPlayer.desktop
else
  cp $INSTALL_DIR/AmbulantPlayer-scalable.png  $HICOLOR/scalable/hildon/pkg_AmbulantPlayer-app.png
  cp $INSTALL_DIR/AmbulantPlayer-40x40.png  $HICOLOR/40x40/hildon/pkg_AmbulantPlayer-app.png
  cp $INSTALL_DIR/AmbulantPlayer-26x26.png  $HICOLOR/26x26/hildon/pkg_AmbulantPlayer-app.png
  cp $INSTALL_DIR/AmbulantPlayer.desktop $DESKTOP
fi
#XXXX how to generate these ambulant.mo files
cp $INSTALL_DIR/en.mo $EN_LC_MESSAGES/ambulant.mo
cp $INSTALL_DIR/nl.mo $NL_LC_MESSAGES/ambulant.mo
cp $INSTALL_DIR/com.nokia.ambulantplayer_app.service $SERVICE

# 4. Generate the package
#
# SRC_DIR is used in debian/rules to tell the installer where to find the sources
export SRC_DIR=$AMBULANT_TOPDIR
echo Creating the package
dpkg-buildpackage -rfakeroot -b 
if [ $? ]
then (cd ..;echo The installer is created as: `pwd`/$APPLICATION-app_$VERSION_armel.deb)
fi
