<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.3.0: http://docutils.sourceforge.net/" />
<title>Ambulant design, main objects</title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document" id="ambulant-design-main-objects">
<h1 class="title">Ambulant design, main objects</h1>
<p>Last updated for Ambulant version 1.1.</p>
<p>This document describes the function of various of the more important
objects and interfaces in the Ambulant Player. If you haven't already done
so it is probably a good idea to first read the <a class="reference" href="overall.html">Overall design</a> and 
<a class="reference" href="walkthrough.html">walkthrough</a> documents. The first one explains the design principles and
some of the choices made, the second one is a brief walkthrough of how the
player loads, parses and plays a SMIL document.</p>
<div class="section" id="ambulantplayer-interfaces">
<h1><a name="ambulantplayer-interfaces">AmbulantPlayer interfaces</a></h1>
<ul class="simple">
<li><a class="reference" href="player.html">Player</a>. This is the toplevel object.</li>
<li><a class="reference" href="document.html">Document</a>. The representation of a SMIL document. This document
also contains a description of the DOM tree (<tt class="literal"><span class="pre">node</span></tt> objects) and related
objects.</li>
<li><a class="reference" href="parser.html">Parser</a>. Describes the interfaces to the XML parser.</li>
<li><a class="reference" href="datasource.html">Data source</a>. Think of these as &quot;media items&quot;, they may refer to a URL
or part of a multiplexed stream or so, and provide data to renderers and
to the parser.</li>
<li><a class="reference" href="playable.html">Playable</a> and <a class="reference" href="renderer.html">Renderer</a>. These two interfaces together make
media items appear on-screen. The first one is the interface as the scheduler
uses it to start and stop playback. The second interface is specific to
media items that appear on-screen, and handles things like reacting to
redraw requests.</li>
<li><a class="reference" href="layout.html">Layout</a>. This document describes the interfaces that are responsible
for determining where and how the media items are displayed.</li>
</ul>
</div>
<div class="section" id="ambulantplayer-objects">
<h1><a name="ambulantplayer-objects">AmbulantPlayer Objects</a></h1>
<ul class="simple">
<li><a class="reference" href="event_processor.html">Event processor</a>. This is the mainloop plus the event/callback mechanism.</li>
<li><a class="reference" href="region.html">Region</a>. This is an area of screen space, it is part of an implementation
of the Layout objects sketched above.</li>
<li><a class="reference" href="#clocks">Clocks</a>. These advance a virtual time.</li>
<li><a class="reference" href="timeline.html">Timeline</a>. This is a description of another scheduler: the MMS scheduler.
This scheduler has a much simpler structure than the SMIL 2.0 scheduler.</li>
</ul>
<p>For each of these we have an accompanying PDF document with UML graphics
showing how the object relates to other objects. These can be found
in the <a class="reference" href="../models">models</a> directory.</p>
<p>In addition we have various auxiliary objects that are explained in
<a class="reference" href="auxobjects.html">auxobjects.txt</a>.</p>
<p>You may notice that the core of the player, the SMIL 2.0 scheduler, is not
mentioned here. Unfortunately it is not documented yet.</p>
</div>
<div class="section" id="refcounting-protocol">
<h1><a name="refcounting-protocol">Refcounting protocol</a></h1>
<p>The <cite>refcounting protocol</cite> is contained in the file <tt class="literal"><span class="pre">lib/refcount.h</span></tt>. It needs to
be implemented only by objects that are truly shared, i.e. any object whose
lifetime is not predetermined by some other object. New instances of refcounted
objects are created using the operator new. Any object that needs to share
a particular instance calls add_ref against this instance. The creator
of the refcounted object and any sharer are responsible to call the release
function of the object when they don't need the object any more.</p>
</div>
<div class="section" id="clocks">
<h1><a name="clocks">Clocks</a></h1>
<p>All clocks adhere to the <tt class="literal"><span class="pre">abstract_timer</span></tt> interface. This interface
allows you to get the current time and set the speed of the clock.</p>
<p>There is a companion interface <tt class="literal"><span class="pre">abstract_timer_client</span></tt> (which is actually
a base class of <tt class="literal"><span class="pre">abstract_timer</span></tt>) that allows objects to get notification
of changes in timer speed.</p>
<p>Currently there are two implementations of the <tt class="literal"><span class="pre">abstract_timer</span></tt> interface:
the operating-system specific realtime clock (of which you cannot set the
speed) and <tt class="literal"><span class="pre">timer</span></tt>, which implements a new zero-based clock
based on another <tt class="literal"><span class="pre">abstract_timer</span></tt>. Its speed is settable
with <tt class="literal"><span class="pre">set_speed</span></tt>, but it is tightly synchronized with its parent clock.</p>
<p>Eventually there will be other implementations of <tt class="literal"><span class="pre">timer</span></tt>,
such as clocks that are allowed to slip synchronization and other such
semantics as required by SMIL.</p>
</div>
</div>
</body>
</html>
