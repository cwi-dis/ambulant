To make a distribution make sure you do:


Before creating the distribution
================================

- make sure your CVS tree is up to date and that there are no uncommited files
- make sure all /*AM_DBG*/ have been changed into AM_DBG
- make sure all the correct renderers are configured (for example the
  quicktime video renderer on the mac)
- change the version number in:
  - configure.in
  - include/ambulant/version.h
  - src/player_macosx/Info.plist
  - src/player_macosx/*.lproj/InfoPlist.strings
  - src/player_wince/AmbulantPlayer.rc
  - src/player_mfc/AmbulantPlayer.rc (Dialog IDD_ABOUTBOX)
  - src/AmbulantWin32Installer/AmbulantWiseInstaller.wse
  	- Product Details->Default Directory
  	- General Information->Installation Version
  	- Add/Remove Programs -> Software Version
  	- Shortcuts
  - src/AmbulantWin32Installer/AmbulantWinCEWiseInstaller.wse
  	- Product Details->Default Directory
  	- Add/Remove Programs -> Software Version
  	- General Information->Installation Version
- check the following files for being up-to-date:
  - README
  - INSTALL
  - Documentation/misc/README-ZAURUS
  - Documentation/misc/README-Distribution (this file)
  - third_party_packages/readme.txt
- You must update NEWS, give a high-level overview of what has changed.
- You must update Changelog. There is a tool cvs2cl that does this
  more-or-less automatically, something like the following command line should
  do the trick:
  
  % cvs log -b -d '>'2004-07-01 | cvs2cl.pl --hide-filenames --stdout --stdin
  (the perl script is on http://www.red-bean.com/cvs2cl/cvs2cl.pl).

- Update the API documentation in Documentation/API by running doxygen
  Read and check the documentation for consistency, errors and missing items.

- Update the translations:
  - in po, run "make ambulant.pot-update"
  - Edit the various ".po" files. Especially check empty strings
    and fuzzy matches.

To create the linux source distribution
=======================================

- Check out a clean copy from CVS, follow the instructions in README-CVS
- Make sure you configure with *all* options (--with-xerces --with-live)
  otherwise not all sources will be included
- Use make distcheck
- If make distcheck complains about not being able to find expat, 
  you have to set the path to the expat library via the environment variable:
 

	DISTCHECK_CONFIGURE_FLAGS="--with-expat=`pwd`/third_party_packages/expat-unix --with-ffmpeg=`pwd`/third_party_packages/ffmpeg-0.4.8" make distcheck
- make dist
- Check on a (preferably virgin) machine, again with all options enabled.

Creating the third_party_packages-WIN32 distribution
====================================================

To be supplied.

Binary distribution contents
============================

All binary distribution should contain the following files:
- README
- the player binary, preferable staticly linked
- COPYING (The GNU License)
- DemoPresentation from Extras

Windows desktop also needs:
- Welcome from Extras
- AmbulantPlayerHelp.chm from Documentation/user-htmlhelp

Windows CE needs:
- Welcome from Extras

Zaurus needs:
- Welcome from Extras
- README-ZAURUS from Documentation/misc
- Documentation/user

Creating the MacOSX installer
=============================

- Build the whole source tree, don't forget options for
  enabling xerces, etc. You want to build with Xerces in a plugin,
  i.e. with
    configure --with-xerces --with-xerces-plugin
- Install the player in src/player_macos.
- Create a folder called something like "Ambulant Player 1.2", 
  and copy the items mentioned above into it.
- Use Applications->Utilities->Disk Utilities to create a .dmg
  disk image from this folder (read only, compressed). Make sure the
  version number is part of the disk image name.

Creating the Windows desktop installer
======================================

Build the player. Make sure you are building a *Release* player,
not a *Debug* player.

Open src/AmbulantWin32Installer/AmbulantWiseInstaller.wse with Wise.
Make sure the files mentioned above are included. If you need to add more
files: Wise will use absolute paths by default (for the source files), you
want to turn these into relative paths.

The installer will be deposited in bin/win32. You need to change the filename
to include the version number.

Creating the Windows CE installer
=================================

Build the player. Make sure you are building a *Release* player,
not a *Debug* player.

Open src/AmbulantWin32Installer/AmbulantWinCEWiseInstaller.wse with Wise.
The procedure is pretty similar as for the desktop windows player, the
installer ends up in bin/wince.

Creating the Zaurus installer
=============================

To be supplied.

Creating the Linux installer
============================

For this release we will probably not do Linux binary installers,
but as we have done one before we should write down the procedure here.


Testing the distributions
=========================

Here are some random remarks about testing the distributions.

- The Mac player must definitely be tested on a virgin machine,
  to ensure there are no dependencies on dynamic libraries in /usr/local
  or something like that.
  
- On all platforms, test either on a virgin machine or at least
  clear out preferences before testing (unix: $HOME/.ambulant;
  mac: ~/Library/Preferences/org.ambulantplayer.ambulantplayer.plist;
  windows: HKEY_CURRENT_USER\Software\Ambulant\AmbulantPlayer in the registry).
  
- On windows, test on at least Win98, Win2K and WinXP.
  
- Make sure Welcome plays at first run. Check that the preferences have
  sensible defaults (log level: trace, parser: expat, log window: closed).

- Then play DemoPresentation/NYC-SMIL2.smil.
  Then play the website documents. Use the Xerces parser. Open the log window,
  select "debug" output, and make sure that there aren't any accidental
  AM_DBG's left on.
  
- For each platform, try and get someone knowledgable with the platform but
  not the Ambulant Player to build the distribution.
  
- On the platforms that support it (Linux, Mac) test localisation. We
  should have at least English and Dutch working.
  
- On each platform, check that the version numbers are correct in things
  like the about dialog, Get Info (Properties) in the Finder (Explorer), etc.

- We can use vin.cst.cwi.nl to test it on newer distributions then our desktop.
  (at this moment fedora core 3)

  
Uploading the distributions
===========================

Adding a new file release package
---------------------------------
A release package is a collection of file releases (binary as well as
source) for different platforms but the with same version number. To add
a SF release package choose in the admin menu File Releases. At the
bottom of the page you will find a field where you can add the name of a
new release package. We have to use different names for our release
packages. (such that the latest release is always on top). I propose to
use the following naming scheme, Ambulant <version number> (eg Ambulant
1.0, Ambulant 1.2). The minor release number is always even for stable
releases, the development version uses the uneven numbers.

Adding file releases to a release package
-----------------------------------------
To add files to a release package choose in the admin menu File
releases. At the bottom you will find an overview of all the release
packages, click on Add Release next to the release package  you want to
add a release to. You will be asked a release new release name. Make
sure this name is a unique name (so we can easily track it down in the
SF stats). The next step is to upload and add the file belonging to the
release. Upload the file to upload.sourceforge.net and click on Edit
Releases belonging to the release package your editing in the package
overview, and click again on edit release next to the release you want
to add a file to. Fill in the neccesary information in Step 1, and
select the file in Step 2. In Step 3 fill in the right processor type
and file type for the released file.

Proposed naming scheme for release names:

- Binary packages: ambulant-<versionnumber>-<platform>.ext (eg. for
  windows ambulant-1.2-win32.exe, for mac ambulant-1.2-osx.dmg).
- Source package: I think the name make distcheck gives to the package is
  fine. eg ambulant-1.2.tar.gz. Don't use ".tgz", winzip doesn't like it.

Again the minor release number indicates a stable release if the number is even.


Hiding a file release package
-----------------------------
Make sure that all file releases belonging to a file release package are hidden.
If not, you can not hide the release package and it will stay active.

Updating the website
====================

To be supplied. Here are some random thoughts:
- The design and API docs need to be uploaded
- The SMIL documents need to be uploaded (if changed)



Advertising the distributions
=============================

To be supplied. Some ideas, plus who knows how to submit things):
- ambulant-announce
- ambulant-users
- www-smil
- W3C
-   http://guide.apple.com/usindex.lasso (jack)
-   http://www.apple.com/downloads/macosx/submit (jack)
-   http://www.versiontracker.com/ (jack, userid Jack.Jansen@oratrix.com)
-   http://www.macshareware.net (jack, userid jackjansen)
	- A macpad file is in www.cwi.nl/~jack/macpad. There's a pad file there too.
-   archivist@info-mac.org (jack)
-   adcnews@apple.com? (jack)
-   news@macnn.com (jack)
-   http://www.macupdate.com

linux:
- www.freshmeat.net
- www.tweakers.net
- www.slashdot.org

